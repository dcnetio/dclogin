
syntax = "proto3";

package pb;

service PayService {
   // 获取套餐列表
  rpc GetPackages(GetPackagesRequest) returns (GetPackagesResponse);

  // 创建订单
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  
  // 获取Native支付二维码
  rpc GetNativePrepay(GetNativePrepayRequest) returns (GetNativePrepayResponse);

  // 获取存储购买状态
  rpc GetStoragePurchaseStatus(GetStoragePurchaseStatusRequest) returns (GetStoragePurchaseStatusResponse);
}

// ==================== 获取套餐列表 ====================

// 获取套餐列表请求
message GetPackagesRequest {
  int32 pkg_type = 1;         // 套餐类型 1.nowcode会员费 2.app发布时的应用购买 3.存储购买
  string lang = 2;            // 套餐名称语言 如: zh, en
  string currency = 3;        // 货币代码 人民币CNY，美元USD
}

// 获取套餐列表响应
message GetPackagesResponse {
  int32 code = 1;             // 状态码 0-成功
  string msg = 2;             // 消息
  repeated PackageInfo data = 3;  // 套餐列表
}

// 套餐信息
message PackageInfo {
  int32 pkg_id = 1;           // 套餐ID
  int32 pkg_type = 2;         // 套餐类型
  string pkg_name = 3;        // 套餐名称
  string lang = 4;            // 语言
  int32 amount = 5;           // 套餐金额（分）
  string currency = 6;        // 货币代码
  int32 valid_days = 7;       // 有效天数
  int32 call_times = 8;       // 次数
  int32 chain_pkg_id = 9;     // 区块链套餐ID
  int32 space_size = 10;      // 存储大小（GB）
  string create_time = 11;    // 创建时间
}

// ==================== 创建订单 ====================

// 创建订单请求
message CreateOrderRequest {
  string account = 1;         // 账户
  int32 pkg_id = 2;           // 套餐ID
  string description = 3;     // 订单描述
  AmountInfo amount = 4;      // 金额信息
  string dappid = 5;          // dappid 应用发布时使用
}

// 金额信息
message AmountInfo {
  int32 total = 1;            // 总金额（分）
}

// 创建订单响应
message CreateOrderResponse {
  int32 code = 1;         // 返回码 0-成功
  string msg = 2;         // 返回消息
  CreateOrderData data = 3;   // 订单数据
}

// 订单数据
message CreateOrderData {
  string out_trade_no = 1;    // 商户订单号
}

// ==================== 获取Native支付预付单 ====================

// 获取Native支付预付单请求
message GetNativePrepayRequest {
  string out_trade_no = 1;    // 商户订单号
}

// 获取Native支付预付单响应
message GetNativePrepayResponse {
  int32 code = 1;                    // 状态码 0-成功
  string msg = 2;                    // 消息
  NativePrepayData data = 3;         // 预付单数据
}

// Native预付单数据
message NativePrepayData {
  string code_url = 1;        // 微信支付二维码链接
}

// ==================== 获取存储购买状态 ====================
// 创建订单请求
message GetStoragePurchaseStatusRequest {
  string out_trade_no = 1;    // 商户订单号
}

// 创建订单响应
message GetStoragePurchaseStatusResponse {
  int32 code = 1;         // 返回码 0-成功
  string msg = 2;         // 返回消息
  GetStoragePurchaseStatusData data = 3;   // 订单数据
}

// 订单数据
message GetStoragePurchaseStatusData {
  int32 status = 1;    // 存储购买状态 1.等待确认 2.购买成功
}